@model JamesRecipes.Models.Membership

@{
    ViewData["Title"] = "CheckMember";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<p>End Date: @Model.EndDate</p>
<p>Is Active: <span id="isActive">@Model.IsActive</span></p>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        CheckMember();
    });

    // Hàm thực hiện yêu cầu AJAX để cập nhật trạng thái
    function CheckMember() {
        // Lấy ID và trạng thái "isActive" từ các nguồn dữ liệu thích hợp
        var id = '@Model.MembershipId'; // Lấy ID từ nguồn dữ liệu tương ứng
        var isActive = '@Model.IsActive'; // Lấy trạng thái "isActive" từ nguồn dữ liệu tương ứng

        // Tạo đối tượng XMLHttpRequest
        var xhr = new XMLHttpRequest();

        // Thiết lập yêu cầu POST đến địa chỉ cập nhật trạng thái
        xhr.open('POST', '/Paypal/CheckMember', true);

        // Thiết lập callback function để xử lý kết quả sau khi yêu cầu hoàn thành
        xhr.onload = function () {
            if (xhr.status === 200) {
                // Xử lý kết quả trả về
                var response = JSON.parse(xhr.responseText);
                var updatedIsActive = response.isActive;

                // Cập nhật trạng thái "isActive"
                if (isActive !== updatedIsActive) {
                    isActive = updatedIsActive;
                    UpdateIsActive(isActive); // Gọi hàm cập nhật trạng thái
                }
            } else {
                // Xử lý lỗi (nếu có)
                // ...
            }
        };

        // Gửi yêu cầu với dữ liệu được mã hóa
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.send('id=' + encodeURIComponent(id) + '&isActive=' + encodeURIComponent(isActive));
    }

    // Hàm cập nhật trạng thái "isActive" trong HTML
    function UpdateIsActive(isActive) {
        var isActiveElement = document.querySelector('#isActive');
        isActiveElement.innerHTML = isActive;
    }
</script>
